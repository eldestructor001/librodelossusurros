<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>La Noche de los Susurros en Hu√©rcal ‚Äî Libro Digital</title>
</head>

<body>
  <div class="app" role="application">
    <header>
      <div class="logo">SUSURROS</div>
      <div>
        <h1>La Noche de los Susurros en Hu√©rcal</h1>
        <p class="lead">Libro digital ‚Äî versi√≥n m√≥vil. Sigue las pistas, completa los retos y rompe la maldici√≥n antes
          de medianoche.</p>
      </div>
    </header>

    <div class="panel" id="startPanel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Equipo</div>
          <input id="teamName" type="text" placeholder="Nombre del equipo (p.ej. Los Valientes)" />
        </div>
        <div style="text-align:right">
          <div class="small">Tiempo</div>
          <div class="timer" id="timer">00:00:00</div>
        </div>
      </div>
      <div class="controls">
        <button id="btnStart">Comenzar el ritual</button>
        <button id="btnHint" class="hintBtn">Pedir pista (-2 min)</button>
        <div style="margin-left:auto" class="small">P√∫blico ‚Äî Guarda resultados localmente</div>
      </div>
      <div class="status" id="status">Pulsa <strong>Comenzar el ritual</strong> para iniciar el cron√≥metro y desbloquear
        la primera prueba.</div>
    </div>

    <!-- Section template -->
    <div id="flow" class="hide">

      <!-- Punto 1 Pitonisa -->
      <div class="panel section" id="sec1">
        <h3>üîÆ Punto 1 ‚Äî La Pitonisa (Cortijo Moreno)</h3>
        <div class="prompt">En el viejo cortijo, una pitonisa contempla una esfera de luz. Su mirada atraviesa el
          tiempo, pero solo si sois capaces de ver lo que ella ve.</div>
        <p class="small">Prueba: Observad la esfera de luz que os mostrar√° tres colores. Escribe en el orden correcto
          los colores que la pitonisa menciona (separados por comas).</p>
        <label>Respuesta (p.ej. rojo, blanco, verde)</label>
        <input id="ans1" type="text" autocomplete="off" />
        <div style="margin-top:8px">
          <button onclick="check1()">Enviar respuesta</button>
          <button class="hintBtn" onclick="useHint()">Pista (-2 min)</button>
        </div>
        <div id="msg1" class="small" style="margin-top:8px;color:#f2f2f2"></div>
      </div>

      <!-- Punto 2 Motosierra -->
      <div class="panel section" id="sec2">
        <h3>üî™ Punto 2 ‚Äî T√∫nel del Eco Carmes√≠</h3>
        <div class="prompt">El rugido del metal resuena en la oscuridad del t√∫nel. Solo quien descubra el n√∫mero maldito
          podr√° cruzar al otro lado.</div>
        <label>Introduce el n√∫mero que has encontrado en la pared del t√∫nel</label>
        <input id="ans2" type="text" autocomplete="off" />
        <div style="margin-top:8px">
          <button onclick="check2()">Enviar respuesta</button>
          <button class="hintBtn" onclick="useHint()">Pista (-2 min)</button>
        </div>
        <div id="msg2" class="small" style="margin-top:8px;color:#f2f2f2"></div>
        <div id="reward2" class="result hide"></div>
      </div>

      <!-- Punto 3 Zombie -->
      <div class="panel section" id="sec3">
        <h3>üßü Punto 3 ‚Äî El Silencio del Muerto (quiere.fueran.solito)</h3>
        <div class="prompt">El aire huele a tierra h√∫meda. Un cuerpo se levanta con el sonido hueco del hambre y la
          condena.</div>
        <p class="small">Acertijo (resuelve en voz alta o escribe el n√∫mero):</p>
        <pre style="background:rgba(0,0,0,0.3);padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.02)">Tres tumbas hay en el campo,
en una descansa un alma, en otra dos,
y la tercera espera al siguiente grupo.

Si cada noche los muertos se levantan y duplican su n√∫mero,
¬øcu√°ntas almas vagar√°n al tercer amanecer?</pre>
        <label>Tu respuesta (n√∫mero)</label>
        <input id="ans3" type="text" autocomplete="off" />
        <div style="margin-top:8px">
          <button onclick="check3()">Enviar respuesta</button>
          <button class="hintBtn" onclick="useHint()">Pista (-2 min)</button>
        </div>
        <div id="msg3" class="small" style="margin-top:8px;color:#f2f2f2"></div>
        <div id="reward3" class="result hide"></div>
      </div>

      <!-- Punto 4 Monja -->
      <div class="panel section" id="sec4">
        <h3>‚õìÔ∏è Punto 4 ‚Äî La Monja del Silencio (Centro Social Jos√© Guirado)</h3>
        <div class="prompt">Detr√°s de los barrotes la monja reza en la oscuridad. Deb√©is encontrar el s√≠mbolo de
          Hu√©rcal: una moneda con su escudo, y marcar que la hab√©is encontrado.</div>
        <p class="small">En el lugar hay una moneda escondida que podr√©is recuperar. Cuando la teng√°is, marcadlo abajo.
        </p>
        <label>¬øHab√©is encontrado la moneda con el escudo de Hu√©rcal?</label>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button onclick="foundCoin(true)" class="coinBtn">S√≠, la tengo</button>
          <button onclick="foundCoin(false)" class="coinBtn">A√∫n no</button>
        </div>
        <div id="msg4" class="small" style="margin-top:8px;color:#f2f2f2"></div>
      </div>

      <!-- Final -->
      <div class="panel section" id="sec5">
        <h3>üîî Final ‚Äî Regreso al punto de inicio</h3>
        <div class="prompt">Regresad al punto donde todo empez√≥. All√≠ confirmar√© vuestro tiempo.</div>
        <p class="small">Cuando llegu√©is al inicio, pulsa el bot√≥n de abajo. Guarda una foto de la moneda si quieres
          conservarla.</p>
        <div style="margin-top:8px">
          <button onclick="finishRun()">He regresado al inicio ‚Äî marcar tiempo</button>
        </div>
        <div id="finalMsg" class="result hide"></div>
      </div>

    </div>

    <footer>Dise√±ado para <strong>La Noche de los Susurros en Hu√©rcal</strong> ‚Äî versi√≥n m√≥vil. Mant√©n el m√≥vil en
      silencio para no romper la ambientaci√≥n.</footer>
  </div>

  <script>
    // Simple client-side app: timer, hints, answer checks, local results store
    let startTs = null;
    let elapsedBefore = 0; // ms
    let timerInterval = null;
    let hintsUsed = 0;
    let teamName = '';

    const correct = {
      1: ['rojo, blanco, verde', 'rojo,blanco,verde', 'rojo blanco verde'], // adjust if you want
      2: '13',
      3: '24'
    };

    function formatTime(ms) {
      const sec = Math.floor(ms / 1000) % 60;
      const min = Math.floor(ms / 60000) % 60;
      const hr = Math.floor(ms / 3600000);
      return `${String(hr).padStart(2, '0')}:${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
    }

    function startTimer() {
      startTs = Date.now();
      timerInterval = setInterval(() => {
        const now = Date.now();
        document.getElementById('timer').textContent = formatTime(now - startTs + elapsedBefore - hintsUsed * 120000);
      }, 250);
    }

    function stopTimer() {
      clearInterval(timerInterval);
    }

    function useHint() {
      hintsUsed++;
      alert('Pista utilizada. Penalizaci√≥n: 2 minutos en el tiempo final.');
    }

    function btnStartClick() {
      teamName = (document.getElementById('teamName').value || 'Equipo sin nombre').trim();
      if (!teamName) { alert('Introduce el nombre del equipo.'); return; }
      document.getElementById('startPanel').classList.add('hide');
      document.getElementById('flow').classList.remove('hide');
      startTimer();
      document.getElementById('status').textContent = 'El cron√≥metro ha comenzado. Seguid las pistas y completad las pruebas.';
      // focus first answer
      document.getElementById('ans1').focus();
    }

    function check1() {
      const val = document.getElementById('ans1').value.toLowerCase().trim();
      const ok = correct[1].includes(val);
      const msg = document.getElementById('msg1');
      if (ok) {
        msg.textContent = 'La pitonisa asiente. Pista desbloqueada: id a la entrada del t√∫nel bajo las v√≠as.';
        // scroll to next
        document.getElementById('sec2').scrollIntoView({ behavior: 'smooth' });
      } else {
        msg.textContent = 'La luz vacila: prueba otra vez.';
      }
    }

    function check2() {
      const val = document.getElementById('ans2').value.trim();
      const msg = document.getElementById('msg2');
      if (val === correct[2]) {
        msg.textContent = 'El hombre de la motosierra se aparta lentamente y os entrega una nota manchada.';
        const r = document.getElementById('reward2');
        r.classList.remove('hide');
        r.innerHTML = `<strong>Nota encontrada:</strong><pre style="white-space:pre-wrap;margin-top:6px">El trece despierta al muerto,\npero no en el camposanto.\nB√∫scalo donde la tierra se abre en cicatrices de barro y polvo.\nAll√≠, entre ruinas y sombras, el silencio camina lento.\n\nTres palabras guardan el secreto del lugar‚Ä¶\nquien quiere, quien fueran, quien camina solito.</pre><div style="margin-top:8px"><a class='link' target='_blank' href='https://what3words.com/quiere.fueran.solito'>Abrir localizaci√≥n</a></div>`;
        document.getElementById('sec3').scrollIntoView({ behavior: 'smooth' });
      } else {
        msg.textContent = 'El eco no os da la respuesta. Volved a mirar la pared.';
      }
    }

    function check3() {
      const val = document.getElementById('ans3').value.trim();
      const msg = document.getElementById('msg3');
      if (val === correct[3]) {
        msg.textContent = 'El zombie se retira con un gemido y deja caer una nota.';
        const r = document.getElementById('reward3');
        r.classList.remove('hide');
        r.innerHTML = `<strong>Nota del muerto:</strong><pre style="white-space:pre-wrap;margin-top:6px">Donde el silencio reza tras los barrotes,\ny la luz parpadea entre oraciones,\nall√≠ purgar√°s tus pecados.</pre><div style="margin-top:8px"><a class='link' target='_blank' href='https://www.google.com/maps/search/?api=1&query=Centro+Social+Jose+Guirado+Calle+del+Pueblo+36+Hu%C3%A9rcal+de+Almer%C3%ADa'>Ir a Centro Social Jos√© Guirado (mapa)</a></div>`;
        document.getElementById('sec4').scrollIntoView({ behavior: 'smooth' });
      } else {
        msg.textContent = 'El muerto no se conforma. Recalculad los huesos.';
      }
    }

    function foundCoin(have) {
      const msg = document.getElementById('msg4');
      if (have) {
        msg.textContent = 'La monja suspira. Hab√©is recuperado el escudo. Pod√©is regresar al inicio.';
        // mark progressed
        document.getElementById('sec5').scrollIntoView({ behavior: 'smooth' });
      } else {
        msg.textContent = 'La monja sigue rezando. Mirad entre las sombras y las bolsas.';
      }
    }

    function finishRun() {
      stopTimer();
      const now = Date.now();
      const raw = (now - startTs + elapsedBefore - hintsUsed * 120000);
      const finalTime = formatTime(raw);
      const out = { team: teamName, time: finalTime, hintsUsed, date: new Date().toISOString() };
      // store locally in browser
      const data = JSON.parse(localStorage.getItem('susurros_runs') || '[]');
      data.push(out);
      localStorage.setItem('susurros_runs', JSON.stringify(data));
      const fm = document.getElementById('finalMsg');
      fm.classList.remove('hide');
      fm.innerHTML = `<strong>Tiempo marcado:</strong> ${finalTime} <br><small>Penalizaci√≥n por pistas: ${hintsUsed} x 2 min</small><pre style="margin-top:8px">Guarda este c√≥digo si quieres probar verificable: ${btoa(JSON.stringify(out)).slice(0, 12)}</pre>`;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // start button
    document.getElementById('btnStart').addEventListener('click', btnStartClick);
    // hint general
    document.getElementById('btnHint').addEventListener('click', () => { useHint(); });

  </script>
</body>

</html>
